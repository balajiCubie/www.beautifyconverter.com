$(function(){function imageConverter(toolName,inputOpts,outputOpts,computeFn){if($('#tool-'+toolName).length==0)return;var fileSelector='#file-select';var submitSelector='#submit';var selectedFile;$(fileSelector).on('change',function(ev){var file=ev.target.files[0];if(file.type!=inputOpts.inputMime){$('#action-error').text("Selected file is not a "+inputOpts.inputHumanFormat);$("#action-error").parents("div.form-group").removeClass("hide");$("html, body").animate({scrollTop:($("h1").offset().top-10)},600);return;}
$("#action-error").parents("div.form-group").addClass("hide");$("html, body").animate({scrollTop:($("html").offset().top-10)},600);selectedFile=file;$(submitSelector).attr('disabled',false);});$('#drag-and-drop').on('dragover',function(ev){ev.preventDefault();ev.stopPropagation();$('#drag-and-drop').addClass('hover');});$('#drag-and-drop').on('dragenter',function(ev){ev.preventDefault();ev.stopPropagation();$('#drag-and-drop').addClass('hover');});$('#drag-and-drop').on('dragleave',function(ev){ev.preventDefault();ev.stopPropagation();$('#drag-and-drop').removeClass('hover');});$('#drag-and-drop').on('dragend',function(ev){ev.preventDefault();ev.stopPropagation();$('#drag-and-drop').removeClass('hover');});$('#drag-and-drop').on('drop',function(ev){ev.preventDefault();ev.stopPropagation();$('#drag-and-drop').removeClass('hover');$("#action-error").parents("div.form-group").addClass("hide");ev.dataTransfer=ev.originalEvent.dataTransfer;var file=ev.dataTransfer.files[0];if(file.type!=inputOpts.inputMime){$("#action-error").parents("div.form-group").removeClass("hide");$('#action-error').text("Selected file is not a "+inputOpts.inputHumanFormat);$("html, body").animate({scrollTop:($("h1").offset().top-10)},600);return;}
$('#drag-and-drop-selected').text("Selected "+file.name);$("html, body").animate({scrollTop:($("html").offset().top-10)},600);selectedFile=file;$(submitSelector).attr('disabled',false);});$(submitSelector).click(function(){var reader=new FileReader();reader.onload=function(){var img=new Image;img.onload=function(){var canvas=$('<canvas>')[0];canvas.width=img.width;canvas.height=img.height;var canvasCtx=canvas.getContext('2d');canvasCtx.drawImage(img,0,0);function blobHandler(blob){var lastDot=selectedFile.name.lastIndexOf('.');if(lastDot!=-1){var outputFileName=selectedFile.name.substring(0,lastDot)+'.'+outputOpts.outputExt;}
else{var outputFileName=selectedFile.name+'.'+optputOpts.outputExt;}
saveAs(blob,outputFileName);}
canvas.toBlob(blobHandler,outputOpts.outputMime);}
img.src=reader.result;}
reader.readAsDataURL(selectedFile);});}
imageConverter('jpg-to-png',{inputMime:'image/jpeg',inputHumanFormat:'JPEG'},{outputMime:'image/png',outputExt:'png'},function(){});imageConverter('png-to-jpg',{inputMime:'image/png',inputHumanFormat:'PNG'},{outputMime:'image/jpeg',outputExt:'jpg'},function(){});imageConverter('png-to-gif',{inputMime:'image/png',inputHumanFormat:'PNG'},{outputMime:'image/gif',outputExt:'gif'},function(){});imageConverter('gif-to-png',{inputMime:'image/gif',inputHumanFormat:'GIF'},{outputMime:'image/png',outputExt:'png'},function(){});imageConverter('gif-to-jpg',{inputMime:'image/gif',inputHumanFormat:'GIF'},{outputMime:'image/jpeg',outputExt:'jpg'},function(){});imageConverter('bmp-to-png',{inputMime:'image/bmp',inputHumanFormat:'BMP'},{outputMime:'image/png',outputExt:'png'},function(){});imageConverter('bmp-to-jpg',{inputMime:'image/bmp',inputHumanFormat:'BMP'},{outputMime:'image/jpeg',outputExt:'jpg'},function(){});});